# Get Where Used

This utility queries Teamcenter for "Where Used" information (finding parent assemblies) for a list of input items, typically generated by `get_items_by_date.py`.

It leverages the `Teamcenter.Services.Strong.Core._2012_02.DataManagement` API to perform precise or imprecise where-used searches and resolves the latest revisions of the parent assemblies.

## Usage

```bash
python get_where_used.py --input <input_file.json> --output <output_file.json> [--host <tc_url>] [--user <username>] [--password <password>] [--parent-type <type_list>]
```

### Arguments

- `--input`: Path to the input JSON file containing a list of items (e.g., output from `get_items_by_date.py`).
- `--output`: Path to the output JSON file where results will be saved.
- `--host`: (Optional) The Teamcenter host URL. Defaults to `TC_URL` in `.env` or `http://localhost:8080/tc`.
- `--user`: (Optional) Teamcenter username. Defaults to `TCUSER` in `.env`.
- `--password`: (Optional) Teamcenter password. Defaults to `TCPASSWORD` in `.env`.
- `--parent-type`: (Optional) Comma-separated list of Teamcenter types to filter parents by (e.g., "ItemRevision, Design Revision").

### Example

```bash
python get_where_used.py --input january_items.json --output january_usage.json --parent-type "ItemRevision"
```

## Input Format

The input file should be a JSON array of objects, where each object has at least a `uid` or a `latest_revision.uid` field.

```json
[
  {
    "item_id": "000123",
    "latest_revision": {
      "uid": "QkRE..."
    }
  }
]
```

## Output Format

The output is a JSON array mirroring the input, but adding a `used_in` list for each item.

```json
[
  {
    "input_item": {
      "item_id": "000123",
      ...
    },
    "used_in": [
      {
        "item_id": "000999",
        "uid": "AbcD...",
        "object_name": "Main Assembly",
        "latest_revision": {
          "item_revision_id": "B",
          "creation_date": "..."
        }
      }
    ]
  }
]
```

## Technical Details

- **API Used**: `Teamcenter.Services.Strong.Core._2012_02.DataManagement.WhereUsed`
- **Configuration**:
  - `numLevels`: 1 (Immediate parents only)
  - `whereUsedPreciseFlag`: False (Imprecise search)
- **Performance**:
  - Uses bulk loading (`LoadObjects`) in chunks to avoid SOA limits.
  - Uses `ObjectPropertyPolicy` to strictly limit the properties returned by the server, optimizing network payload.
